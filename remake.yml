## All R files that are used must be listed here:

packages:
  - dplyr
  - magrittr
  - lubridate
  - tidyr
  - mvabund
  - ggplot2
  - lubridate
  - vegan
  - pryr
  - rmarkdown

sources:
  - R.scripts/results.R
  - R.scripts/data_cleaning.R
  - R.scripts/data_organizing.R
  - R.scripts/run_analyses.R
  
targets:
  all:
    depends: 
      - figures/Fig1.png
      - MS/OrgSize.pdf
      - inverts_tts_ini_win
      - inverts_adonis_win_ini
      - zoops_adonis_win_ini
      - bact_adonis_win_ini
      - inverts_adonis_win_fin
      - zoops_adonis_win_fin
      - bact_adonis_win_fin

### read in data, including each bacterial file

  insects:
    command: read_data("raw-data/insect.communities.table.txt")
  
  insectnames:
    command: read.csv("raw-data/insectnames.csv", stringsAsFactors=FALSE)
    
  blocks:
    command: read_data("raw-data/blocks.txt")
    
  bromeliad:
    command: read_data("raw-data/bromeliad.volumes.txt")

  inverts:
    command: clean_insect_names(insects, insectnames)
    quiet: true

  zoops:
    command: clean_zooplankton("raw-data/zoop.txt")

# bacteria
## three species experiment
  bact_1:
    command: read_clean_bact("raw-data/bacteria/between_species/block1.csv")
        
  bact_2:
    command: read_clean_bact("raw-data/bacteria/between_species/block2.csv")
        
  bact_3:
    command: read_clean_bact("raw-data/bacteria/between_species/block3.csv")
        
  bact_4:
    command: read_clean_bact("raw-data/bacteria/between_species/block4.csv")
        
  bact_5:
    command: read_clean_bact("raw-data/bacteria/between_species/block5.csv")
    
## within sp experiment
  bact_2_within:
    command: read_clean_bact_within("raw-data/bacteria/within_species/bloco2.csv")
    
  bact_4_within:
    command: read_clean_bact_within("raw-data/bacteria/within_species/bloco4.csv")
    
  bact_5_within:
    command: read_clean_bact_within("raw-data/bacteria/within_species/bloco5.csv")
   
## Process bacteria data into a list
  bact_list:
    command: >
      list(bact_1 = bact_1, bact_2 = bact_2, bact_3 = bact_3,
           bact_4 = bact_4, bact_5 = bact_5)
           
  bact_list_within:
    command: >
      list(bact_2 = bact_2_within, 
           bact_4 = bact_4_within, 
           bact_5 = bact_5_within)

### three species
  bact_df:
    command: bact_list_to_df(bact_list) 

### within species
  bact_df_within:
    command: bact_list_to_df(bact_list_within) 

## THREE SPECIES
  inverts_tts_ini:
    command: TaxaTimeSelector(inverts, .blocks = blocks, .bromeliad = bromeliad, sampletime = I("initial"))

  zoops_tts_ini:
    command: TaxaTimeSelector(zoops, .blocks = blocks, .bromeliad = bromeliad, sampletime = I("initial"))

  bact_tts_ini:
    command: TaxaTimeSelector(bact_df, .blocks = blocks, .bromeliad = bromeliad, sampletime = I("initial"))

  inverts_tts_fin:
    command: TaxaTimeSelector(inverts, .blocks = blocks, .bromeliad = bromeliad, sampletime = I("final"))

  zoops_tts_fin:
    command: TaxaTimeSelector(zoops, .blocks = blocks, .bromeliad = bromeliad, sampletime = I("final"))

  bact_tts_fin:
    command: TaxaTimeSelector(bact_df, .blocks = blocks, .bromeliad = bromeliad, sampletime = I("final"))  
    
## WITHIN SPECIES 
### inverts
  inverts_tts_win_ini:
    command: > 
      TaxaTimeSelector(inverts, .blocks = blocks, 
      .bromeliad = bromeliad, sampletime = I("initial"),
      .experiment = I("withinsp"))

  inverts_tts_win_fin:
    command: > 
      TaxaTimeSelector(inverts, .blocks = blocks, 
      .bromeliad = bromeliad, sampletime = I("fin"),
      .experiment = I("withinsp"))

### zoops    
  zoops_tts_win_ini:
    command: > 
      TaxaTimeSelector(zoops, .blocks = blocks, 
      .bromeliad = bromeliad, sampletime = I("initial"),
      .experiment = I("withinsp"))

  zoops_tts_win_fin:
    command: > 
      TaxaTimeSelector(zoops, .blocks = blocks, 
      .bromeliad = bromeliad, sampletime = I("fin"),
      .experiment = I("withinsp"))
      
  ### bacteria
  bact_tts_win_ini:
    command: > 
      TaxaTimeSelector(bact, .blocks = blocks, 
      .bromeliad = bromeliad, sampletime = I("initial"),
      .experiment = I("withinsp"))

  bact_tts_win_fin:
    command: > 
      TaxaTimeSelector(bact, .blocks = blocks, 
      .bromeliad = bromeliad, sampletime = I("fin"),
      .experiment = I("withinsp"))

  ### perform permanovas

## THREE SPECIES
  inverts_adonis_ini:
    command: AdonisData(inverts_tts_ini, method = I("euclid"))

  zoops_adonis_ini:
    command: AdonisData(zoops_tts_ini, method = I("euclid"))

  bact_adonis_ini:
    command: AdonisData(bact_tts_ini, method = I("euclid"))

  inverts_adonis_fin:
    command: AdonisData(inverts_tts_fin, method = I("euclid"))

  zoops_adonis_fin:
    command: AdonisData(zoops_tts_fin, method = I("euclid"))

  bact_adonis_fin:
    command: AdonisData(bact_tts_fin, method = I("euclid"))

  ## WITHIN SPECIES
    
  inverts_adonis_win_ini:
    command: AdonisData(inverts_tts_win_ini, method = I("euclid"))

  zoops_adonis_win_ini:
    command: AdonisData(zoops_tts_win_ini, method = I("euclid"))

  bact_adonis_win_ini:
    command: AdonisData(bact_tts_win_ini, method = I("euclid"))

  inverts_adonis_win_fin:
    command: AdonisData(inverts_tts_win_fin, method = I("euclid"))

  zoops_adonis_win_fin:
    command: AdonisData(zoops_tts_win_fin, method = I("euclid"))

  bact_adonis_win_fin:
    command: AdonisData(bact_tts_win_fin, method = I("euclid"))

  ## Figures  
  figures/Fig1.png:
    command: > 
      r2_plot(inverts_adonis_ini, inverts_adonis_fin,
              zoops_adonis_ini, zoops_adonis_fin,
              bact_adonis_ini, bact_adonis_fin)
    plot: true
    
  figures/Fig1.pdf:
    command: > 
      r2_plot(inverts_adonis_ini, inverts_adonis_fin,
              zoops_adonis_ini, zoops_adonis_fin,
              bact_adonis_ini, bact_adonis_fin)
    plot: true

  MS/SuppMatt.md:
    depends:
      - inverts_adonis_ini
      - zoops_adonis_ini
      - bact_adonis_ini
      - inverts_adonis_fin
      - zoops_adonis_fin
      - bact_adonis_fin
    knitr: true
    
  MS/OrgSize.pdf:
    depends:
      - figures/Fig1.pdf
    command: render("MS/OrgSize.md")
