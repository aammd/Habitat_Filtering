---
title: "The effect of habitat variation on organisms of different body size"
author: "A. Andrew M. MacDonald, Vinicius F. Farjalla , Diane S. Srivastava"
fontsize: 12pt
output:
  pdf_document:
    includes:
      in_header: formatting/myheader.tex
    latex_engine: xelatex
  md_document: default
  html_document: default
  word_document:
    reference_docx: formatting/reference.docx
geometry: margin=1in
bibliography: orgsize.bib
csl: formatting/the-american-naturalist.csl
---

```{r echo=FALSE}
fig_nums <- captioner()
tab_nums <- captioner(prefix = "Table")
fig <- pryr::partial(fig_nums, display = "cite")
tab <- pryr::partial(tab_nums, display = "cite")
```


## Abstract

At the local scale, species composition of often varies among habitat patches in
response to differences in environmental variables. These differences act as
"filters": organisms cannot occur in a habitat patch when their sensitivity to
local environmental conditions prevents their establishment or persistence.
However, not all groups of organisms are equally sensitive to the same
environmental variables. Observational studies have already suggested that
larger-bodied species are more strongly filtered by habitat than smaller- bodied
species. However, this mechanism has never been tested experimentally. In our
study we placed highly similar aquatic communities (composed of insects,
zooplankton and bacteria) into different environments and observed subsequent
divergence in composition. We predicted that insects would show a strong change
in composition, zooplankton a moderate change and bacteria little to no change.
Our results are consistent with these predictions, with the exception of a
weaker signal in insects than expected. These results suggest that organism size
could provide a framework for integrating studies of environmental filtering
across different scales and systems.

## Introduction

models of community assembly explain how local species composition are assembled from the regional species pool. They can be divided into neutral and niche-based processes. Neutral processes are based on the demographic equivalence of all species. the relative abundance of species in any local patch is dependent on their frequency in the regional species pool, paired with stochastic demographic processes such as immigration and emigration. In contrast, niche-based models of community assembly emphasize the trait differences among species. In these models, species are able to coexiest if they posses sufficeniently different traits (stabilizing processes) and their relative abundance is due to differences in their fitness (e.g. survival and reproduction). Niche-based models emphasize how the presence of species in a site is correlated with the abiotic and biotic conditions of that site. These determine whether a species is able to colonize or persist in a given patch. In niche-based, as in neutral models, variance in community composition is also derived from stochasticity in demographic processes. Both categorite of model also make predictions about how patches differ from each other in species composition (beta diversity). In a neutral model, differences between patches are caused by stochasticity in demographic processes, particularly dispersa.  In a niche-based model this variation is increased by variation among habitat patches, which selects for different species compositions in each. Separating the different patterns produced by these two methods usually involves variance partitioning. This approach has its detractors. But the question remains for ecologists: when and under what circumstances will local communities be assembled by neutral or niche-based processes? 

 In one of the first studies across different groups of
organisms in the same community, Farjalla et al. [-@Farjalla2012] demonstrated that body
size is a key trait determining environmental signal in community composition. They conducted an observational study across many different organism types, spanning orders of magnitude in body size, along a single environmental gradient. They considered two different hypotheses regarding how increasing body size should change the balance of niche-based vs neutral community assembly processes. The size-dispersal and size-plasticity hypotheses. The former hypothesis suggests that larger animals have weaker dispersal -- therefore more stochasticity in community composition -- while smaller organisms have such high dispersal rates that variation in composition must be driven by the suitability of the local environment. In contrast the size-plasticity hypothesis suggests that more important than the ability to disperse is the differences in the local environment. That is, smaller organisms should be less sensitive to environmental variation (ie more plastic) and larger organisms more so. They found that groups of organisms which are physically larger show a greater degree of
habitat filtering: there is weaker environmental structure as body size
decreases from insects (strong signal), zooplankton (moderate signal) and bacteria
(weak signal). Their analysis of observational data found support for the size-plasticity hypothesis.

Why should the strenght of environmental filtering decrease with organism size? there are two possible mechanisms that may make communities of smaller organisms more strongly filtered. At the individual level, organisms which are very small maybe able to find microhabitats in a way that mitigates varation abmong patches. smaller organisms also have simpler metabolisms. Bacteria are often able to consume a wide variety of carbon sources. Bacteria can even use environmental DNA, or transfer plasmids among unrelated cells, acquiring new functions. 

Dispersion -- this hypothesis also tells us something about how we should expect to see communities change over time.

The individual-level effects suggested by the size-plasticity hypothesis are difficult to test because of population level processes: especially dispersal. At the population level, smaller organisms may also show less of a relationship with environmental variation. if smaller organisms disperse more rapidly, then we would expect to see populations of smaller species maintained, even in patches where they have negative population growth rates (i.e. mass effects). smaller organisms have higher growth rates, higher rates of turnover, and shorter generation times. This suggests that they could persiste in highly variable or fluctuation habitats, purely by demographic processes. Also, they could stick aroun by evolution, as they have larger effects population sizes (does mutation rate show an effect with regard to population size?). rapid evolution to antiobotics is well know.
In both cases, therefore, space is an issue -- the processes of dispersal can either exaggerate or diminish the effects seen by Farjalla et al. 

However, the work of Farjalla et al suggests a manipulative experiment: to
remove variation among patches, while preserving abiotic variation. If these
environmental differences. We studied the same groups of organisms (insects,
zooplankton and bacteria) in the same patchy, highly variable habitat (three
species of tank bromeliads). We created communities that were as similar as
possible in composition, then exposed these communities to their original
environmental conditions.



We test three different predictions of the size-plasticity hypothesis: 

Question 1: communities which begin at a simiar species composition will diverge, but this divergence
will be greatest between larger species and increasingly weak in smaller
organisms

Question 2: This increase in beta diversity will correlate with environmental differences; this correlation will be stronger for larger organisms.

Question 3: The specific taxa responding to environmental variation will possess traits that are related to their ability to sustain highly variable environments.




## Methods

### Experimental design

Our goal is to investigate the patterns observed by Farjalla et al.
[-@Farjalla2012], therefore we performed this experiment in the same location
along the same environmental variation. The location we used is the Parque
Nacional de Jurubatiba, Northeast Rio de Janeiro state, Brazil ($22^{\circ}$ S
$41^{\circ}$); the environmental gradient is three different species of
bromeliad. Each species of bromeliad is found in a different habitat of the
park: _Aechmea nudicaulis_ (full sun habitats), _Vriesea neoglutinosa_
(partial shade), and _Neoregelia cruenta_ (full shade). _Neoregelia_ has a
uniquely large habitat range at this site, occuring in both full shade and
full sun; only shade plants were used in this study. As is common for
bromeliads, plants used in this study collect standing water (phytotelmata) in
deep leaf axils, and are known to contain diverse communities  of
macroinvertebrates, zooplankton and bacteria.

```{r}
str_end <- blocks %>% 
	filter(experiment == "threespp") %>% 
	select(setup.date) %>% 
	mutate(sdate = ymd(setup.date)) %>% 
	filter(sdate %in% range(sdate)) %>% 
	.[["setup.date"]]
```

We homogenized the community of macroinvertebrates, zooplankton and bacteria
among all three bromeliad species. We collected six bromeliads -- two of each
species -- sampled them, and mixed their communities together (see `r fig("design")`, description of sampling below.).  Our goal was to create identical starting community composition for all bromeliads within a block. Variation between blocks in starting community composition is thus included in the random effect of blocks. We created five blocks in this experiment between `r str_end[[1]]` and `r str_end[[2]]`.

![img](../photos/text_design.png) `r fig_nums("design", "A schematic of our
experimental design. In our initial collection (1) we sampled six bromeliads
(two each of the three species shown here). We formed homogeneous initial communities (2) by counting equal numbers of animals (macroinvertebrates) or by mixing water samples of equal volume from all plants (zooplankton and bacteria). We then returned these initial communities to the six bromeliads (3), and replaced the bromeliads in their original habitats.")`

Our experimental setup consisted of three steps (`r fig("design")`): initial
collection, forming initial communities, and replacing them in their original
(now empty) bromeliads. **Initial collection**: We sampled macroinvertebrates
by thoroughly rinsing each bromeliad and passing the water through 1mm and
180μm mesh to collect aquatic macroinvertebrates. These mesh sizes have been
shown to separate macro invertebrates from both coarse detritus and fine
particulate organic matter, facilitating their collection. We identified
macroinvertebrates to morphospecies. We sampled the zooplankton and bacteria
communities by collecting a water sample from each bromeliad: 100ml for
zooplankton, 50ml for bacteria. Zooplankton were collected by filtering on
50-micron Nytex mesh and fixed in 5% buffered formalin. This fixed solution
was then diluted to 20 ml, and a 1 ml subsample taken for analysis.
Zooplankton were  identified to the lowest taxonomic unit possible (species in
most cases, except for bdelloid rotifers and harpaticoid copepods, left at the
level of class and order, respectively). Bacteria were collected by taking
some of the filtrate from the zooplankton sample and filtering it a second
time on a Whatman filter paper. We measured bacterial community composition
using denaturing gradient gel electrophoresis (DGGE, Muyzer et al. [@Muyzer1993]). This
technique measures an approximation of bacterial diversity in the form of
Operational Taxonomic Units (OTUs). **Initial communities**: we created
initial communities of zooplankton and microbes by mixing an equal volume of
filtered tank water from each plant (approximately 100ml plant^-1^), then dividing this mixed volume among all individual bromeliads. To create initial communities of macroinvertebrates, we simply counted them all and divided them equally among all bromeliads. **Bromeliad preparation**: We emptied
bromeliads by washing them thoroughly, hanging them upside down to dry for at least 24 hours and then
rinsing each plant with 70% ethanol. Any coarse detritus found in the
bromeliads was similarly cleaned, frozen and thawed (to kill any
macroinvertebrates eggs). We confirmed that this technique removed all
invertebrates and most detritus by dissecting an empty bromeliad. Bromeliads
were placed in a local habitat similar to their original: _Neoregelica_ in shade, _Aechmea_ in full sun and _Vresia_ in marginal habitat. We then added the starting
communities of macroinvertebrates, zooplankton and bacteria.

Bromeliads are an open system, characterized by continual colonization and
emergence. Both of these processes are problematic for our question: if we
were to allow colonization it could swamp any changes in our starting
community composition. Conversely, if we allowed the experiment to continue
for too long any macroinvertebrates with complex life cycles would emerge,
leaving us with no community to sample [@Lecraw2014]. We took two steps to
make sure that our treatment effects were not affected by colonization or
excessive emergence. To prevent colonization we surrounded bromeliads with
mosquito netting (mesh size approx. 1.5 mm). To prevent emergence we ended our
experiment after 12 days, based on the results of a pilot study that
confirmed that this was sufficient time for treatments to change, but not so
long that bromeliads were empty.


### Analyses

*Question 1: less beta diversity among smaller organism types* If smaller taxa
are more plastic, we should see less variation in community composition among
bromeliads for smaller organism types. That is, we should see less beta
diversity among bromeliads at the end of the experiment than we saw at the
beginning. We tested this by calculating multivariate dispersions
[@Anderson2006] between all six bromeliads (i.e. distances to centroid of all bromeliads within one block) before and
after the experiment. We repeated this comparison for all five blocks, and for
all three organism types. We used the `betadisper` function in the R package
vegan [@vegan], which provides a permutation test to test for differences in
dispersion before and after the experiment within each block (999 null
simulations block^-1^). For the purposes of this analysis, we used the Raup-Crick measure of dissimilarity. We extracted the mean distance to centroid `r fig("disp")` for each block before and after the experiment. We did this because our hypothesis concerns an interaction: specifically, that the difference in mean distance to centroid (i.e. the slopes of lines in `r fig("disp")`) decline with decreasing organism size. This allowed us to test these differences with a mixed effect linear model including the main effect of sampling time (before and after) organism type (macroinvertebrate, zooplankton and bacteria) and their interaction, with a random effect for block.

*Question 2: less environmental signal among smaller organism types*
The size-plastisicy hypothesis predicts that variation in communiy composition among bromeliads should be more correlated with environment for larger organism types. This correlation should be weaker for smaller groups. We tested this hypothesis with a permutational ANOVA (PERMANOVA), which measures the amount of difference
in community composition between treatment groups and compares this to the
expected distribution under a null hypothesis of no treatment effects. In each PERMANOVA we used block as an error strata, meaning that permutations were performed within blocks. We repeated this analysis for all three organism groups, and at both "initial" and "final" sampling dates (i.e. at the beginning and end of the experiment).

*Question 3: Particular traits are correlated with environmental signal*

The distance-based approaches described above test the response of the whole
community, but community-level responses are often driven by the response of a
smaller number of species. These species often posses particular traits which
correlate with their responses. We tested this hypothesis with multivariate
generalized linear models [@mvabund], which is a  model-based multivariate
alternative to distance-based methods [@Warton2012]. This technique is implemented in the R package `mvabund`  [@Wang2012;@mvabund]. We used this approach to fit the model:

$log(\mu_{jkl}) =  intercept_{j} + block_{jk} + bromeliad_{jl} + block \times bromeliad_{jkl}$

Where $\mu_{jkl}$ is the response of species $j$ in block $k$ to the environment of bromeliad $l$. This model is used to predict the mean of a negative binomial distribution: 

$Y_{ij} \sim NegBin(\mu_{jkl}, \phi_{j})$

Here, $Y_{ij}$ is the abundance of species $j$ in plant $i$. The dispersion parameter, $\phi_{j}$, measures the variablity of species $j$ (constant across sites). We fit these models to final community composition only.

This approach has three advantages that make it suitable for our application.
First, because it is based on GLMs, we are able to model the mean-variance
relationship common in count data. This characteristic of count data is often
problematic for distance-based metrics, which can conflate differences in
dispersion with differences in location [@Warton2012]. We are already testing
for dispersion and location effects in the separate analysis described above
with distance based methods. Therefore this multivariate GLM approach helps
confirm our findings by accounting for both within a different framework.
Second, because it is model-based, it allows us to test for an interaction
between our treatments (different bromeliad species) and blocks. Significance
in these tests is generated by permutation tests based on 1000 replications.
Third, mvabund also allows for estimating individual species-level responses, via a correction for repeated family-level testing [@Wang2012].
This lets us identify which species responded most to the environmental
differences, and to relate these to traits of these species. 

All statistical analyses were conducted in R [@rcore]. Code to reproduce the analysis published here is available at ***link to data***


## Results   
```{r echo = FALSE}
per_decline <- mean((disp_diffs$initial - disp_diffs$final)/disp_diffs$initial)
pdiff <- sprintf("%.0f", per_decline * 100)
gettime <- function(tax, .r2_plot_df){
  ans <- .r2_plot_df %>% 
    filter(taxa == tax)
  
  ret <- sprintf("%.2f", ans$number)
  names(ret) <- ans$time
  ret
}

# med_inv <- sprintf("%.0f", median(gettime("inverts", r2_plot_df)))
inv_r2 <- gettime("inverts", r2_plot_df) 
zoops_r2 <- gettime("zoops", r2_plot_df) 
bact_r2 <- gettime("bact", r2_plot_df) 
```

*Question 1: less beta diversity among smaller organism types*
All organism groups showed the same decrease in mean distance to centroid at the end of the experiment -- there was no significant interaction between organism type and the effect of sampling time (`r fig("disp")`, Mixed effect model F~2,20~ = `r getFP_aov(tidy_mixed, "Fvalue", "taxa:timing")`, `r check_aov_p(tidy_mixed, "taxa:timing")`). However, we did see a `r pdiff`% decrease in the dispersion at the end of the experiment (F~1,20~ = `r getFP_aov(tidy_mixed, "Fvalue", "timing")`, `r check_aov_p(tidy_mixed, "timing")`).

*Question 2: less environmental signal among smaller organism types*
Bromeliad species identity explains more variation in community composition of invertebrates, and less and less for zooplankon and bacteria (`r fig_nums("bw_spp")` ). We tested this by performing six PERMANOVAs, summarized in `r tab("perm_3sp")`. For all organism types, the bromeliad species explained less of the variation at the end of the experiment than at the beginning. For macroinvertebrates, bromelaid species explained around 30% of the variation at the beginning and end of the experiment (R^2^ of `r inv_r2["ini"]` and `r inv_r2["fin"]`, respectively), while explaining less in zooplankton (`r zoops_r2["ini"]` and `r zoops_r2["fin"]`) and very little in bacteria (`r bact_r2["ini"]` and `r bact_r2["fin"]`).


*Question 3: Particular traits are correlated with environmental signal*
```{r echo=FALSE}

extract_tab <- function(mglmtab, .term){
	mglmtab %>% 
 	 filter(term == .term) %>% 
 	 .[["Dev"]] %>% 
 	 sprintf("%.2f", .)
}

inverts_interact <- extract_tab(inverts_manyglm_table, "Block:species")
zoops_interact <- extract_tab(zoops_manyglm_table, "Block:species")
bact_interact <- extract_tab(bact_manyglm_table, "Block:species")
```
We wanted to use the manyglm approach to measure test if smaller organism types respond less to the same environmental gradient than larger ones. To do this, we measured the percent of the total deviance explained by the combination of $bromeliad_{jl}$ and $block \times bromeliad_{jkl}$ terms in our model. These terms explained high proportions of deviance for insects and zooplankton (`r percent_dev_sp(inverts_manyglm_table)` and `r percent_dev_sp(zoops_manyglm_table)`, respectively) and less for bacteria (`r percent_dev_sp(bact_manyglm_table)`). This agrees with our hypothesis, and with the PERMANOVA results reported above. We were obliged to combine terms for this analysis, because there was always a significant interaction between block and species in our models (ie, we could not examine main effects of species independently; See Supplementary Material). 





### Tables	

```{r echo=FALSE}
getF <- function(x) sprintf("%.2f", x[["aov.tab"]][["F.Model"]][[1]])
getP <- function(x) x[["aov.tab"]][["Pr(>F)"]][[1]]
getR <- function(x) sprintf("%.2f", x[["aov.tab"]][["R2"]][[1]])
```

`r tab_nums("perm_3sp", "Results from PERMAOVAs run on each of the three groups of organisms, both before and after the experiment. Both F-ratios and R^2^ values are higher for inverts than they are for zooplankton or bacteria")`

|                    |        | F                            | p                            | R^2^                         |
| -------- | ------------------| ---------|--------- | ---------- |
| macroinvertebrates | before | `r getF(inverts_adonis_ini)` | `r getP(inverts_adonis_ini)` | `r getR(inverts_adonis_ini)` |
|                    | after  | `r getF(inverts_adonis_fin)` | `r getP(inverts_adonis_fin)` | `r getR(inverts_adonis_fin)` |
| zooplankton        | before | `r getF(zoops_adonis_ini)` | `r getP(zoops_adonis_ini)` | `r getR(zoops_adonis_ini)` |
|                    | after  | `r getF(zoops_adonis_fin)` | `r getP(zoops_adonis_fin)` | `r getR(zoops_adonis_fin)` |
| bacteria           | before | `r getF(bact_adonis_ini)` | `r getP(bact_adonis_ini)` | `r getR(bact_adonis_ini)` |
|                    | after  | `r getF(bact_adonis_fin)` | `r getP(bact_adonis_fin)` | `r getR(bact_adonis_fin)`                             |


### Figures

![disp](../figures/plot_disp_taxa.pdf)
`r fig_nums("disp", "behold the figure of dispersion")`

![between](../figures/r2_plot.pdf)
`r fig_nums("bw_spp", "The x-axis has the group studied. the Y axis the r2 of the data from a PERMANOVA. It turns out that a organisms get smaller, the effect of time on the species composition of the data gets weaker")`

![indiv](../figures/individual_responses.pdf)
`r fig_nums("indiv", "individual responses")`


## Discussion

We did discover different amounts of environmental signal ithe different groups -- more in invertebrates and zooplankton than in bacteria. In the direction that we expected, based on the size-sensitivity hypothesis. We found support for these same patterns when we examined individual species responses -- more species of insects showed a change in response to environmental variation than did zooplankton. No bacteria OTU ever showed a predictable difference between before and after. Just as Farjalla et al predicted, the strength of environmental fitlering is in negative proportion to body size. Over the same time interval, insects and zooplankton developed more of a response to the environment than did bacteria. 

We found that dispersion, in all cases, was lower at the end of the experiment than at the beginning. This indicates that our treatments were effectingve in removing beta diverstiy among patches. that is, that all habitats really did end up being very similar at the beginning, as we would expect. However, the amount of this decline was the same across all organism groups (`r tab("disp_tab")`), as indicated by the 

The difference between insects and zooplankton was not as great as we expected it would be. that was probably because we were missing the active vs passive differences. Insect females choose where to place their eggs, evalutating resources and predation risk (citecitecite). On the other hand, the macroinvertebrate taxa that did respond are also the more abundant taxa; it may be that we only had the ability to detect patterns for these taxa. Both of these issues at once (should we do permanova on mortality?). Both size does predict some of the variation in response to the environment. Since active dispersers are also larger, there is then a relationship between that life history and body size -- larger animals are more likely to disperse actively. It may be that those groups show a response in that direction as well. 

In conclusion, here we have shown that a hypothesis made by variance partitioning and by observations, can be supported by a manipulative experiment and a different statistical approach. that, I guess, is probably good news for variance partitioning methods, which have come under a lot of criticism lately. iN our experiment we removed the variation in community composition between habitats, and were essentially able to watch the recovery of beta diversity in our system. Measured as both turnover and dispersion, in that test I haven't even done yet. 

In other words our experiment has not only confirmed some aspects of the body size habitat senstivity experiment, but also investigated the rate at which beta diversity is recovered for these different groups. p 

## References
